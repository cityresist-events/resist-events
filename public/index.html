<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resist Events</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;500;600;700;800;900&family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=UnifrakturCook:wght@700&family=IM+Fell+English:ital@0;1&family=Oswald:wght@400;500;600;700&family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&family=Fraunces:opsz,wght@9..144,400;9..144,700;9..144,900&family=Permanent+Marker&family=Caveat:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/styles.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
</head>
<body>

<!-- ======= DEMO MODE BANNER ======= -->
<div class="demo-banner" id="demoBanner" style="display:none;">
  DEMO MODE — Role: <span id="demoBannerRole">Guest</span> · <button class="btn btn-ghost btn-xs" style="color:var(--amber);" onclick="showDemoRoleModal()">Switch Role</button>
</div>

<!-- ======= DEMO ROLE SELECTOR ======= -->
<div class="demo-role-modal" id="demoRoleModal" style="display:none;">
  <div class="modal-box">
    <div class="modal-header">
      <h2>Choose Your Demo Role</h2>
    </div>
    <div class="modal-body">
      <p style="color:var(--text-muted); margin-bottom: 8px;">This is a demo instance. Pick a role to explore the app:</p>
      <div class="demo-role-options">
        <button class="demo-role-btn" onclick="setDemoRole('guest')">
          <div class="role-icon">&#x1F441;</div>
          <div class="role-info">
            <h4>Guest</h4>
            <p>Browse events and organizations. Read-only access.</p>
          </div>
        </button>
        <button class="demo-role-btn" onclick="setDemoRole('organizer')">
          <div class="role-icon">&#x1F4CB;</div>
          <div class="role-info">
            <h4>Organizer</h4>
            <p>Create and manage events, message site admins.</p>
          </div>
        </button>
        <button class="demo-role-btn" onclick="setDemoRole('admin')">
          <div class="role-icon">&#x1F6E0;</div>
          <div class="role-info">
            <h4>Admin</h4>
            <p>Full access. Approve events, manage organizations.</p>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ======= HEADER ======= -->
<header class="site-header">
  <div class="header-inner">
    <a href="#" class="site-logo" onclick="showSection('home'); return false;">
      <div class="logo-icon">R</div>
      <span class="logo-text" data-config="site_name"><span class="highlight" data-config="site_region"></span> Resist Events</span>
    </a>
    <div class="header-auth">
      <div class="user-badge" id="userBadge">
        <span class="dot"></span>
        <span id="userBadgeName">Loading...</span>
      </div>
      <button class="btn btn-ghost btn-sm" id="loginBtn" onclick="cfAccessLogin()" style="display:none;">Log In</button>
      <button class="btn btn-ghost btn-sm" id="logoutBtn" onclick="cfAccessLogout()" style="display:none;">Log Out</button>
    </div>
  </div>
</header>

<!-- ======= NAV ======= -->
<nav class="nav-bar">
  <div class="nav-inner" id="navInner">
    <button class="nav-btn active" data-section="home" onclick="showSection('home')">Home</button>
    <button class="nav-btn" data-section="purpose" onclick="openModal('purposeModal')">Our Purpose</button>
    <button class="nav-btn" data-section="today" onclick="showSection('today')">Today's Events</button>
    <button class="nav-btn" data-section="calendar" onclick="showSection('calendar')">Full Calendar</button>
    <button class="nav-btn" data-section="orgs" onclick="showSection('orgs')">Organizations</button>
    <button class="nav-btn" data-section="sync" onclick="openModal('syncModal')">Sync to Phone</button>
    <div class="nav-divider organizer-only"></div>
    <button class="nav-btn organizer-btn organizer-only" data-section="myEvents" onclick="showSection('myEvents')">My Events <span class="nav-badge" id="myEventsBadge" style="display:none;background:var(--sage);">0</span></button>
    <button class="nav-btn organizer-btn organizer-only" data-section="contact" onclick="showSection('contact')">Messages <span class="nav-badge" id="messagesBadge" style="display:none;background:var(--sage);">0</span></button>
    <div class="nav-divider admin-only"></div>
    <button class="nav-btn admin-btn admin-only" onclick="toggleAdminDrawer()">Admin</button>
  </div>
</nav>

<!-- ======= MAIN ======= -->
<main class="main-content">

  <!-- HOME -->
  <div id="section-home" class="section-panel active">
    <div class="hero-section fade-in">
      <h1 id="heroTitle">Together We<br><span class="accent">Show Up.</span></h1>
      <p class="hero-subtitle" id="heroSubtitle">One calendar for every rally, march, meeting, and action. Find your people. Make your voice heard.</p>
      <div class="hero-stats">
        <div class="hero-stat" id="statEventsWrap">
          <div class="hero-stat-num" id="statEvents">--</div>
          <div class="hero-stat-label">Upcoming Events</div>
        </div>
        <div class="hero-stat" id="statOrgsWrap">
          <div class="hero-stat-num" id="statOrgs">--</div>
          <div class="hero-stat-label">Organizations</div>
        </div>
        <div class="hero-stat" id="statMobilizedWrap">
          <div class="hero-stat-num" id="statMobilized">--</div>
          <div class="hero-stat-label">People Mobilized</div>
        </div>
      </div>
    </div>

    <h2 class="section-title" style="margin-top: 48px;">Upcoming Events</h2>
    <p class="section-subtitle">Next few events across all organizations</p>

    <div class="events-grid" id="homeEventsGrid">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- TODAY'S EVENTS -->
  <div id="section-today" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Today's Events</h2>
        <p class="section-subtitle" id="todayDateLabel"></p>
      </div>
    </div>
    <div id="todayEventsGrid" class="events-grid"></div>
    <div id="todayEmpty" class="empty-state" style="display:none;">
      <div class="empty-state-icon">&#x1F4C5;</div>
      <h3>No events scheduled for today</h3>
      <p>Check the full calendar for upcoming actions.</p>
    </div>
  </div>

  <!-- FULL CALENDAR -->
  <div id="section-calendar" class="section-panel">
    <h2 class="section-title">Event Calendar</h2>
    <p class="section-subtitle">Browse all scheduled events</p>

    <!-- View Toggle -->
    <div class="cal-view-toggle">
      <button class="cal-toggle-btn active" id="toggleAgenda" onclick="switchCalView('agenda')">Agenda</button>
      <button class="cal-toggle-btn" id="toggleMonth" onclick="switchCalView('month')">Month</button>
    </div>

    <!-- Agenda View (default) -->
    <div id="agendaView">
      <div class="agenda-nav">
        <button class="btn btn-ghost" onclick="changeWeek(-1)">&larr; Previous</button>
        <div class="agenda-nav-center">
          <h3 id="agendaWeekLabel"></h3>
          <span class="agenda-this-week" id="agendaThisWeek"></span>
        </div>
        <button class="btn btn-ghost" onclick="changeWeek(1)">Next &rarr;</button>
      </div>
      <div class="agenda-legend" id="agendaLegend"></div>
      <div id="agendaDays"></div>
    </div>

    <!-- Month View (existing, hidden by default) -->
    <div id="monthView" style="display:none;">
      <div class="cal-nav">
        <button class="btn btn-ghost" onclick="changeMonth(-1)">&larr; Prev</button>
        <h3 id="calMonthLabel"></h3>
        <button class="btn btn-ghost" onclick="changeMonth(1)">Next &rarr;</button>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>
  </div>

  <!-- ORGANIZATIONS -->
  <div id="section-orgs" class="section-panel">
    <div class="orgs-header">
      <div class="orgs-header-left">
        <h2 class="section-title">Participating Organizations</h2>
        <p class="section-subtitle" id="orgsSubtitle">Groups working together</p>
      </div>
      <div class="orgs-header-right">
        <input type="text" class="form-input" id="orgsSearch" placeholder="Search orgs..." oninput="filterOrgs()">
        <select class="form-input" id="orgsCityFilter" onchange="filterOrgs()">
          <option value="">All Cities</option>
        </select>
      </div>
    </div>
    <div class="orgs-stats" id="orgsStats"></div>
    <div id="orgsList"></div>
  </div>

  <!-- NEW EVENT FORM -->
  <div id="section-newEvent" class="section-panel">
    <h2 class="section-title" id="eventFormTitle">Register a New Event</h2>
    <p class="section-subtitle">Fill out the details below to submit your event for review</p>

    <form id="eventForm" onsubmit="return false;">
      <!-- Basic Info -->
      <div class="form-section">
        <div class="form-section-title"><span class="icon">&#x1F4CC;</span> Event Details</div>
        <div class="form-group">
          <label class="form-label">Event Title *</label>
          <input type="text" class="form-input" id="eventTitle" placeholder="e.g. March for Climate Justice" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Start Date & Time *</label>
            <input type="datetime-local" class="form-input" id="eventStart" required>
          </div>
          <div class="form-group">
            <label class="form-label">End Date & Time *</label>
            <input type="datetime-local" class="form-input" id="eventEnd" required>
          </div>
        </div>
        <!-- Recurring (inline below date/time) -->
        <div class="form-group" style="margin-bottom:8px;">
          <label class="form-check">
            <input type="checkbox" id="recurringCheck" onchange="toggleRecurring()">
            This is a recurring event
          </label>
          <p class="form-hint">Automatically create multiple events on a schedule</p>
        </div>
        <div id="recurringFields" style="display:none;margin-bottom:20px;">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Repeat Every</label>
              <select class="form-input" id="recurringFrequency">
                <option value="weekly">Weekly</option>
                <option value="biweekly">Every 2 Weeks</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Number of Occurrences</label>
              <input type="number" class="form-input" id="recurringCount" min="2" max="52" value="4" placeholder="e.g. 4">
            </div>
          </div>
          <p class="form-hint">Each occurrence will be created as a separate event with the same details. You can edit individual events after creation.</p>
        </div>

        <div class="form-group" id="sponsorOrgGroup">
          <label class="form-label">Sponsoring Organization</label>
          <select class="form-input" id="sponsorOrg" onchange="onSponsorOrgChange()">
            <!-- Populated by JS -->
          </select>
          <div id="sponsorOrgOtherGroup" style="display:none;margin-top:8px;">
            <input type="text" class="form-input" id="sponsorOrgCustom" placeholder="Type a custom organization name..." style="margin-bottom:8px;">
            <select class="form-input" id="sponsorOrgAllOrgs" onchange="onSponsorOrgAllOrgsChange()">
              <option value="">— Or choose from existing organizations —</option>
            </select>
          </div>
          <p class="form-hint">Choose the organization sponsoring this event. Events from your own org display a verified badge.</p>
        </div>
        <div class="form-group">
          <label class="form-label">Event Description *</label>
          <textarea class="form-textarea" id="eventDesc" placeholder="Describe the event, its goals, and what attendees can expect..." required></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Event Type</label>
          <select class="form-input" id="eventType" onchange="onEventTypeChange()">
            <option value="">— Select Type —</option>
            <option value="march">March</option>
            <option value="protest_gathering">Protest Gathering</option>
            <option value="signature_gathering">Signature Gathering</option>
            <option value="community_event">Community Event</option>
            <option value="virtual">Virtual</option>
            <option value="other">Other</option>
          </select>
          <input type="text" class="form-input" id="eventTypeCustom" placeholder="Enter custom event type..." style="display:none;margin-top:8px;">
          <p class="form-hint">Used for flyer template color variants</p>
        </div>
      </div>

      <!-- Location -->
      <div class="form-section">
        <div class="form-section-title"><span class="icon">&#x1F4CD;</span> Location</div>
        <div class="form-group">
          <label class="form-check">
            <input type="checkbox" id="virtualEventCheck" onchange="toggleVirtualEvent()">
            This is a virtual / online event
          </label>
        </div>
        <div id="locationFields">
          <div class="form-group">
            <label class="form-check">
              <input type="checkbox" id="hideAddressCheck" onchange="toggleAddressVisibility()">
              Require registration to see the address
            </label>
          </div>
          <div class="form-group" id="addressGroup">
            <label class="form-label">Address *</label>
            <input type="text" class="form-input" id="addressInput" placeholder="123 Main St, Camelot, CA 90210" required>
            <p class="form-hint">Full street address with city and ZIP for map integration</p>
          </div>
          <div class="form-group">
            <label class="form-label">Parking Information</label>
            <textarea class="form-textarea" id="eventParking" rows="2" placeholder="e.g. Free street parking available on 3rd Ave, paid lot at..."></textarea>
          </div>
        </div>
      </div>

      <!-- Links -->
      <div class="form-section">
        <div class="form-section-title"><span class="icon">&#x1F517;</span> Links</div>
        <div class="form-group">
          <label class="form-label">Event Flyer URL</label>
          <input type="url" class="form-input" id="eventFlyer" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">Organization / Event Website</label>
          <input type="url" class="form-input" id="eventWebsite" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">Registration Link</label>
          <input type="url" class="form-input" id="regLink" placeholder="https://...">
          <div style="margin-top: 8px;">
            <label class="form-check">
              <input type="checkbox" id="regRequiredCheck">
              Registration is required
            </label>
          </div>
        </div>
      </div>

      <!-- What to Bring -->
      <div class="form-section">
        <div class="form-section-title"><span class="icon">&#x1F392;</span> What to Bring</div>
        <div class="chip-group" id="bringChips">
          <button type="button" class="chip" onclick="toggleChip(this)">Sunscreen <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Water <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Hearing Protection <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Protest Signs <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Hat / Sun Shade <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">First Aid Kit <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Portable Charger <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Comfortable Shoes <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="add-chip-btn" onclick="addCustomChip('bringChips')">+ Add Item</button>
        </div>
      </div>

      <!-- What NOT to Bring -->
      <div class="form-section">
        <div class="form-section-title"><span class="icon">&#x1F6AB;</span> What NOT to Bring</div>
        <div class="chip-group" id="noBringChips">
          <button type="button" class="chip" onclick="toggleChip(this)">Visible Weapons <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Concealed Carry Weapons <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Megaphones / Speakers <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Pets <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="chip" onclick="toggleChip(this)">Alcohol <span class="chip-x">&#x2715;</span></button>
          <button type="button" class="add-chip-btn" onclick="addCustomChip('noBringChips')">+ Add Item</button>
        </div>
      </div>

      <!-- Notes -->
      <div class="form-section">
        <div class="form-section-title"><span class="icon">&#x1F4DD;</span> Notes from the Organizer</div>
        <div class="form-group" style="margin-bottom: 0;">
          <textarea class="form-textarea" id="eventNotes" rows="4" placeholder="Any additional information, instructions, or notes for attendees..."></textarea>
        </div>
      </div>

      <!-- Submit Buttons -->
      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; flex-wrap: wrap;">
        <button type="button" class="btn btn-secondary" onclick="saveEvent('draft')">Save as Draft</button>
        <button type="button" class="btn btn-primary" onclick="saveEvent('review')">Submit for Review</button>
      </div>
    </form>
  </div>

  <!-- MY EVENTS LIST -->
  <div id="section-myEvents" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">My Events</h2>
        <p class="section-subtitle">Manage events you've created</p>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-primary btn-sm organizer-only" onclick="showSection('newEvent')">+ New Event</button>
        <button class="btn btn-secondary btn-sm" id="archiveToggle" onclick="toggleArchivedEvents()">Show Archived</button>
      </div>
    </div>
    <div id="myEventsList"></div>
    <div id="loadMoreEvents" style="text-align: center; margin-top: 16px; display: none;">
      <button class="btn btn-ghost" onclick="loadMoreEvents()">Load 20 More Events</button>
    </div>
  </div>

  <!-- CONTACT US -->
  <div id="section-contact" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Messages</h2>
        <p class="section-subtitle">Send and receive messages with site administrators</p>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-primary btn-sm" onclick="openModal('newMessageModal')">+ New Message</button>
        <button class="btn btn-secondary btn-sm" id="contactArchiveToggle" onclick="toggleArchivedTopics()">Show Archived</button>
      </div>
    </div>
    <div id="contactList"></div>
    <div id="contactThread" style="display: none;"></div>
  </div>

  <!-- REVIEW QUEUE (admin) -->
  <div id="section-reviewQueue" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Admin Queue</h2>
        <p class="section-subtitle">Approve or reject submitted events</p>
      </div>
    </div>
    <div id="reviewQueueList"></div>
    <div id="reviewQueueEmpty" class="empty-state" style="display:none;">
      <div class="empty-state-icon">&#x2705;</div>
      <h3>All caught up!</h3>
      <p>No events pending review.</p>
    </div>
  </div>

  <!-- MANAGE ORGS (admin) -->
  <div id="section-manageOrgs" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Manage Organizations</h2>
        <p class="section-subtitle">Create, edit, and remove organizations</p>
      </div>
      <button class="btn btn-primary btn-sm" onclick="openOrgEditModal()">+ Add Organization</button>
    </div>
    <div id="adminOrgsList"></div>
  </div>

  <!-- ADMIN MESSAGES -->
  <div id="section-adminMessages" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Admin Messages</h2>
        <p class="section-subtitle">All organization and direct messages</p>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="btn btn-primary btn-sm" onclick="openAdminNewMessageModal()">+ New Message</button>
        <button class="btn btn-secondary btn-sm" id="adminMsgArchiveToggle" onclick="toggleAdminArchivedMessages()">Show Archived</button>
      </div>
    </div>
    <div id="adminMessagesList"></div>
    <div id="adminMessagesThread" style="display: none;"></div>
  </div>

  <!-- MANAGE USERS (admin) -->
  <div id="section-manageUsers" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Manage Users</h2>
        <p class="section-subtitle">Create, edit, and remove user accounts</p>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <select class="form-input" id="userOrgFilter" onchange="renderAdminUsers()" style="width:auto;min-width:180px;padding:6px 12px;font-size:12px;">
          <option value="">All Organizations</option>
        </select>
        <button class="btn btn-primary btn-sm" onclick="openUserEditModal()">+ Add User</button>
      </div>
    </div>
    <div id="adminUsersList"></div>
  </div>

  <!-- EVENT SETTINGS (admin) -->
  <div id="section-eventSettings" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Event Settings</h2>
        <p class="section-subtitle">Configure event publishing and organizer permissions</p>
      </div>
    </div>
    <div class="settings-card">
      <h3 class="settings-card-title">Organizer Publishing Permissions</h3>
      <p class="settings-card-desc">Control which organizations organizers can publish events for</p>
      <div class="settings-radio-group" id="orgPermRadios">
        <label class="settings-radio">
          <input type="radio" name="orgPerm" value="own_org_only" checked>
          <div>
            <strong>Own organization only</strong>
            <p>Organizers can only submit events for their own organization. All events require admin approval.</p>
          </div>
        </label>
        <label class="settings-radio">
          <input type="radio" name="orgPerm" value="approved_list">
          <div>
            <strong>Approved organizations</strong>
            <p>Organizers with self-publish permission can publish their own events without approval. Cross-publishing requires the target org to allow it.</p>
          </div>
        </label>
        <label class="settings-radio">
          <input type="radio" name="orgPerm" value="any_org">
          <div>
            <strong>Any organization</strong>
            <p>Organizers can submit events for any organization in the directory. Useful for high-trust communities.</p>
          </div>
        </label>
      </div>
      <button class="btn btn-primary btn-sm" onclick="saveEventSettings()" style="margin-top:16px;">Save Settings</button>
    </div>
  </div>

  <!-- SITE SETTINGS (admin) -->
  <div id="section-siteSettings" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Site Settings</h2>
        <p class="section-subtitle">Configure sitewide appearance and content</p>
      </div>
    </div>
    <div class="settings-card">
      <h3 class="settings-card-title">Sitewide Theme</h3>
      <p class="settings-card-desc">Customize colors, fonts, and branding across the site.</p>
      <p style="color:var(--text-dim);font-size:13px;font-style:italic;margin-top:8px;">Coming soon</p>
    </div>
    <div class="settings-card">
      <h3 class="settings-card-title">Flyer Templates</h3>
      <p class="settings-card-desc">Manage and customize event flyer templates.</p>
      <p style="color:var(--text-dim);font-size:13px;font-style:italic;margin-top:8px;">Coming soon</p>
    </div>
    <div class="settings-card">
      <h3 class="settings-card-title">Homepage Settings</h3>
      <p class="settings-card-desc">Configure site identity, hero content, footer, and modal content.</p>

      <div style="margin-top:16px;">
        <div class="form-group">
          <label class="form-label">Site Name</label>
          <input type="text" class="form-input" id="hpSiteName" placeholder="e.g. Camelot Resist Events">
          <p class="form-hint">Displayed in the browser tab title, site header, and copyright text.</p>
        </div>
        <div class="form-group">
          <label class="form-label">Site Region / City</label>
          <input type="text" class="form-input" id="hpSiteRegion" placeholder="e.g. Camelot">
          <p class="form-hint">Highlighted prefix in the site header. Leave blank to show the full site name instead.</p>
        </div>
        <div class="form-group">
          <label class="form-label">Hero Line 1</label>
          <input type="text" class="form-input" id="hpHeroLine1" placeholder="Together We">
        </div>
        <div class="form-group">
          <label class="form-label">Hero Line 2</label>
          <input type="text" class="form-input" id="hpHeroLine2" placeholder="Show Up.">
        </div>
        <div class="form-group">
          <label class="form-label">Hero Subtitle</label>
          <input type="text" class="form-input" id="hpHeroSubtitle" placeholder="One calendar for every rally, march...">
        </div>

        <div style="display:flex;gap:24px;margin-top:12px;margin-bottom:12px;">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="hpShowEventCount"> Show event count
          </label>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="hpShowOrgCount"> Show Organization count
          </label>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="hpShowMobilizedCount"> Show People Mobilized count
          </label>
        </div>

        <div class="form-group">
          <label class="form-label">Purpose Text (HTML)</label>
          <textarea class="form-input" id="hpPurposeText" rows="5" placeholder="HTML content for the Our Purpose modal..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Privacy Policy (HTML)</label>
          <textarea class="form-input" id="hpPrivacyPolicy" rows="5" placeholder="HTML content for the Privacy Policy modal..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Terms of Service (HTML)</label>
          <textarea class="form-input" id="hpTermsOfService" rows="5" placeholder="HTML content for the Terms of Service modal..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Copyright Text</label>
          <input type="text" class="form-input" id="hpCopyrightText" placeholder="2026 Resist Events · Open source and community-driven">
        </div>
        <div style="margin-top:4px;margin-bottom:4px;">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="hpShowGithubLink"> Show GitHub link
          </label>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
        <button class="btn btn-secondary btn-sm" id="hpPreviewBtn" onclick="previewHomepageChanges()" disabled>Preview Changes</button>
        <button class="btn btn-primary btn-sm" onclick="saveHomepageSettings()">Save Settings</button>
      </div>
    </div>

    <!-- Disable Demo Mode (only visible in demo mode) -->
    <div class="demo-disable-card" id="demoDisableCard" style="display:none;">
      <h3>Disable Demo Mode</h3>
      <p>Permanently wipe all demo data and reset the app to a fresh install state. This cannot be undone.</p>
      <button class="btn btn-danger btn-sm" onclick="showDemoDisableModal()">Disable Demo Mode & Wipe Database</button>
    </div>

    <div class="demo-disable-card" id="demoReseedCard" style="display:none;">
      <h3>Wipe and Re-Seed Database</h3>
      <p>Wipe all changes and restore the demo database to the default seed data. The site will remain in demo mode.</p>
      <button class="btn btn-danger btn-sm" onclick="confirmReseedDatabase()">Wipe and Re-Seed Database</button>
    </div>

  </div>

  <!-- DATABASE SETTINGS (admin) -->
  <div id="section-dbSettings" class="section-panel">
    <div class="section-header">
      <div>
        <h2 class="section-title">Database Settings</h2>
        <p class="section-subtitle">Manage your database: backup, restore, or selectively reset data</p>
      </div>
      <div id="dbSettingsDemoNotice" style="display:none;background:rgba(255,180,50,0.1);border:1px solid rgba(255,180,50,0.3);border-radius:var(--radius-sm);padding:10px 14px;font-size:13px;color:var(--text-muted);max-width:320px;text-align:right;">
        Database settings are disabled in Demo Mode. Use the controls under Site Settings to manage demo data.
      </div>
    </div>
    <!-- Tab navigation -->
    <div class="db-tab-nav">
      <button class="db-tab-btn active" id="db-tab-btn-backup" onclick="switchDbTab('backup')">Backup</button>
      <button class="db-tab-btn" id="db-tab-btn-restore" onclick="switchDbTab('restore')">Restore</button>
      <button class="db-tab-btn" id="db-tab-btn-cleanup" onclick="switchDbTab('cleanup')">Clean Up</button>
      <button class="db-tab-btn" id="db-tab-btn-schedules" onclick="switchDbTab('schedules')">Auto Backup</button>
      <button class="db-tab-btn" id="db-tab-btn-reset" onclick="switchDbTab('reset')" style="margin-left:auto;color:#E05555;">Reset DB</button>
    </div>

    <!-- Tab 1: Backup -->
    <div id="db-tab-backup" class="db-tab-panel settings-card">
      <h3 class="settings-card-title">Backup Database</h3>
      <p class="settings-card-desc">Export an AES-256-GCM encrypted snapshot. Save the encryption key — it's shown once and required to restore.</p>
      <div style="margin-bottom:16px;">
        <label class="form-label">Label (optional)</label>
        <input type="text" class="form-input" id="backupLabel" placeholder="e.g. Pre-migration backup">
      </div>
      <div style="margin-bottom:16px;">
        <label class="form-label">Include tables</label>
        <div style="display:flex;flex-wrap:wrap;gap:12px;margin-top:6px;align-items:center;">
          <label class="form-check" style="font-weight:600;"><input type="checkbox" id="backupFull" onchange="toggleFullBackup(this)" checked> Full Backup</label>
          <span style="color:var(--border);font-size:16px;">|</span>
          <div id="backupTableItems" style="display:flex;flex-wrap:wrap;gap:12px;opacity:0.35;pointer-events:none;">
            <label class="form-check"><input type="checkbox" name="backupItem" value="events" checked> Events</label>
            <label class="form-check"><input type="checkbox" name="backupItem" value="organizations" checked> Organizations</label>
            <label class="form-check"><input type="checkbox" name="backupItem" value="users" checked> Users</label>
            <label class="form-check"><input type="checkbox" name="backupItem" value="messages" checked> Messages</label>
          </div>
        </div>
      </div>
      <button class="btn btn-primary btn-sm db-settings-action" onclick="createBackup()">Create Backup</button>
      <div id="backupListWrap" style="margin-top:20px;">
        <div style="font-size:13px;color:var(--text-muted);">Loading backups...</div>
      </div>
    </div>

    <!-- Tab 2: Restore -->
    <div id="db-tab-restore" class="db-tab-panel settings-card" style="display:none;">
      <h3 class="settings-card-title">Restore Database</h3>
      <p class="settings-card-desc">Select a saved backup below, or upload a backup file from your computer. Only the encryption key is needed — the IV is embedded in the backup file.</p>

      <!-- Server-side backup list -->
      <div style="margin-bottom:16px;">
        <label class="form-label">Saved backups</label>
        <div id="restoreBackupListWrap" style="margin-top:6px;">
          <div style="font-size:13px;color:var(--text-muted);">Loading...</div>
        </div>
      </div>

      <!-- Upload toggle -->
      <div style="margin-bottom:16px;">
        <button class="btn btn-ghost btn-sm" onclick="toggleUploadSection()" id="uploadToggleBtn" style="font-size:12px;">+ Upload a backup file from your computer</button>
        <div id="uploadSection" style="display:none;margin-top:10px;padding:12px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);">
          <label class="form-label">Backup file (.enc)</label>
          <input type="file" class="form-input" id="restoreFile" accept=".enc" onchange="selectUploadedFile(this)">
        </div>
      </div>

      <!-- Selected backup indicator -->
      <div id="restoreSelectedWrap" style="display:none;margin-bottom:14px;padding:10px 14px;background:rgba(80,160,100,0.1);border:1px solid rgba(80,160,100,0.3);border-radius:var(--radius-sm);font-size:13px;display:flex;align-items:center;gap:10px;">
        <span>Selected: <strong id="restoreSelectedLabel"></strong></span>
        <button class="btn btn-ghost btn-xs" onclick="clearRestoreSelection()">Clear</button>
      </div>

      <!-- Key + options -->
      <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px;">
        <div>
          <label class="form-label">Encryption Key (hex)</label>
          <input type="text" class="form-input" id="restoreKey" placeholder="Paste the encryption key shown when this backup was created" style="font-family:monospace;font-size:12px;">
        </div>
        <div>
          <label class="form-label">Restore mode</label>
          <select class="form-input" id="restoreMode">
            <option value="overwrite">Overwrite — delete existing data and replace with backup</option>
            <option value="merge">Merge — add backup data alongside existing records</option>
          </select>
        </div>
        <div>
          <label class="form-label">Tables to restore</label>
          <div style="display:flex;flex-wrap:wrap;gap:12px;margin-top:6px;align-items:center;">
            <label class="form-check" style="font-weight:600;"><input type="checkbox" id="restoreFull" onchange="toggleRestoreFull(this)" checked> Full Restore</label>
            <span style="color:var(--border);font-size:16px;">|</span>
            <div id="restoreTableItems" style="display:flex;flex-wrap:wrap;gap:12px;opacity:0.35;pointer-events:none;">
              <label class="form-check"><input type="checkbox" name="restoreItem" value="events" checked> Events</label>
              <label class="form-check"><input type="checkbox" name="restoreItem" value="organizations" checked> Organizations</label>
              <label class="form-check"><input type="checkbox" name="restoreItem" value="users" checked> Users</label>
              <label class="form-check"><input type="checkbox" name="restoreItem" value="messages" checked> Messages</label>
            </div>
          </div>
        </div>
      </div>

      <button class="btn btn-secondary btn-sm db-settings-action" onclick="previewRestore()">Preview Restore</button>
      <div id="restorePreviewWrap" style="margin-top:16px;display:none;">
        <div id="restorePreviewContent"></div>
        <div style="margin-top:16px;padding:14px;background:rgba(224,85,85,0.08);border:1px solid rgba(224,85,85,0.2);border-radius:var(--radius-sm);">
          <p style="font-size:13px;color:var(--text-muted);margin-bottom:8px;">Type <strong>RESTORE</strong> to confirm and execute:</p>
          <input type="text" class="form-input" id="restoreConfirmInput" placeholder="RESTORE" style="margin-bottom:8px;">
          <button class="btn btn-danger btn-sm db-settings-action" onclick="executeRestore()">Execute Restore</button>
        </div>
      </div>
    </div>

    <!-- Tab 3: Cleanup -->
    <div id="db-tab-cleanup" class="db-tab-panel settings-card" style="display:none;">
      <h3 class="settings-card-title">Clean Up Data</h3>
      <p class="settings-card-desc">Archive or permanently delete old data to keep your database tidy.</p>
      <div id="cleanupCountsWrap" style="margin-bottom:16px;">
        <div style="font-size:13px;color:var(--text-muted);">Loading counts...</div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
        <div>
          <label class="form-label">Action</label>
          <select class="form-input" id="cleanupAction">
            <option value="archive">Archive (hide from normal views)</option>
            <option value="delete">Delete permanently</option>
          </select>
        </div>
        <div>
          <label class="form-label">Auto-delete after (days, 0 = never)</label>
          <input type="number" class="form-input" id="cleanupArchiveDays" value="0" min="0">
        </div>
      </div>
      <div style="margin-bottom:16px;">
        <label class="form-label">Apply to</label>
        <div style="display:flex;flex-wrap:wrap;gap:12px;margin-top:6px;">
          <label class="form-check"><input type="checkbox" id="cleanupEvents"> Archived events</label>
          <label class="form-check"><input type="checkbox" id="cleanupMessages"> Archived messages</label>
          <label class="form-check"><input type="checkbox" id="cleanupArchivedItems"> Expired archive entries</label>
        </div>
      </div>
      <button class="btn btn-danger btn-sm db-settings-action" onclick="executeCleanup()">Execute Cleanup</button>
    </div>

    <!-- Tab 4: Schedules -->
    <div id="db-tab-schedules" class="db-tab-panel settings-card" style="display:none;">
      <h3 class="settings-card-title">Auto Backup Schedules</h3>
      <p class="settings-card-desc">Generate a Cloudflare Worker script to run backups automatically on a cron schedule.</p>
      <div id="scheduleListWrap" style="margin-bottom:20px;">
        <div style="font-size:13px;color:var(--text-muted);">Loading schedules...</div>
      </div>
      <div style="padding:16px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);">
        <h4 style="font-size:14px;font-weight:600;margin-bottom:12px;">New Schedule</h4>
        <div style="display:grid;gap:12px;">
          <div>
            <label class="form-label">Label</label>
            <input type="text" class="form-input" id="schedLabel" placeholder="e.g. Daily Full Backup">
          </div>
          <div>
            <label class="form-label">Cron expression</label>
            <input type="text" class="form-input" id="schedCron" value="0 2 * * *">
            <div style="font-size:11px;color:var(--text-dim);margin-top:4px;">
              <code>0 2 * * *</code> = 2am daily &nbsp;&bull;&nbsp; <code>0 2 * * 0</code> = weekly Sunday &nbsp;&bull;&nbsp;
              <a href="https://crontab.guru" target="_blank" rel="noopener" style="color:var(--sage);">crontab.guru</a> for help building expressions
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div>
              <label class="form-label">Backup type</label>
              <select class="form-input" id="schedType">
                <option value="full">Full</option>
                <option value="events">Events only</option>
              </select>
            </div>
            <div>
              <label class="form-label">Retain for (days)</label>
              <input type="number" class="form-input" id="schedRetention" value="30" min="1">
            </div>
          </div>
        </div>
        <button class="btn btn-primary btn-sm db-settings-action" style="margin-top:12px;" onclick="saveSchedule()">Create Schedule &amp; Generate Script</button>
      </div>
    </div>

    <!-- Tab 5: Reset DB -->
    <div id="db-tab-reset" class="db-tab-panel settings-card" style="display:none;border-color:rgba(224,85,85,0.2);">
      <h3 class="settings-card-title" style="color:#E05555;">Reset Database</h3>
      <p class="settings-card-desc">Selectively clear data from the database. You can reset everything or choose specific categories.</p>
      <button class="btn btn-danger btn-sm db-settings-action" style="margin-top:8px;" onclick="showResetDatabaseModal()">Reset Database...</button>
    </div>
  </div>

</main>

<!-- ======= FOOTER ======= -->
<footer class="site-footer">
  <div class="footer-inner">
    <p id="copyrightText">&copy; 2026 Resist Events &middot; Open source and community-driven</p>
    <div class="footer-links">
      <a href="#" onclick="openModal('privacyModal'); return false;">Privacy Policy</a>
      <span class="footer-sep">|</span>
      <a href="#" onclick="openModal('termsModal'); return false;">Terms of Service</a>
      <span class="footer-sep" id="githubSep">|</span>
      <a href="https://github.com/cityresist-events/resist-events" target="_blank" rel="noopener" id="githubLink">GitHub</a>
    </div>
  </div>
</footer>

<!-- ======= MODALS ======= -->

<!-- PURPOSE MODAL -->
<div class="modal-overlay" id="purposeModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2>Our Purpose</h2>
      <button class="modal-close" onclick="closeModal('purposeModal')">&#x2715;</button>
    </div>
    <div class="modal-body" id="purposeContent">
      <p style="color:var(--text-muted);">Loading...</p>
    </div>
  </div>
</div>

<!-- SYNC MODAL -->
<div class="modal-overlay" id="syncModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2>Sync with Your Phone</h2>
      <button class="modal-close" onclick="closeModal('syncModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom: 20px; color: var(--text-muted);">Subscribe to our event calendar to get automatic updates on your phone or computer.</p>
      <div class="sync-options">
        <div class="sync-option" onclick="copyCalUrl('apple')">
          <div class="sync-option-icon">&#x1F4F1;</div>
          <h4>Apple Calendar</h4>
          <p>Opens Calendar app</p>
        </div>
        <div class="sync-option" onclick="copyCalUrl('gcal')">
          <div class="sync-option-icon">&#x1F4C5;</div>
          <h4>Google Calendar</h4>
          <p>Add to Google Calendar</p>
        </div>
        <div class="sync-option" onclick="copyCalUrl('outlook')">
          <div class="sync-option-icon">&#x1F4BB;</div>
          <h4>Outlook</h4>
          <p>Add to Outlook</p>
        </div>
        <div class="sync-option" onclick="copyCalUrl('copy')">
          <div class="sync-option-icon">&#x1F517;</div>
          <h4>Copy iCal URL</h4>
          <p>For any calendar app</p>
        </div>
      </div>
      <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: var(--radius-sm); border: 1px solid var(--border);">
        <p id="syncCalUrl" style="font-family: var(--font-mono); font-size: 12px; color: var(--text-dim); word-break: break-all;">webcal://example.com/cal/subscribe.ics</p>
      </div>
    </div>
  </div>
</div>

<!-- ORG PROFILE MODAL -->
<div class="modal-overlay" id="profileModal">
  <div class="modal-box" style="max-width:760px;">
    <div class="modal-header">
      <h2>Org Profile</h2>
      <button class="modal-close" onclick="closeModal('profileModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Organization</label>
        <select class="form-input" id="profileOrgSelect" onchange="onProfileOrgChange()"></select>
      </div>
      <div class="form-group">
        <label class="form-label">Organization Public Name</label>
        <input type="text" class="form-input" id="profileOrgName">
      </div>
      <div class="form-group">
        <label class="form-label">Mission Statement</label>
        <textarea class="form-input" id="profileMission" rows="2" maxlength="140"
          oninput="updateMissionCounter()" placeholder="A short sentence describing your org..."></textarea>
        <div style="display:flex;justify-content:space-between;margin-top:4px;">
          <span style="font-size:11px;color:var(--text-dim);">Shown on the public organizations page.</span>
          <span id="missionCounter" style="font-size:11px;color:var(--text-dim);">0 / 140</span>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Organization Website</label>
          <input type="url" class="form-input" id="profileOrgWebsite" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">City</label>
          <input type="text" class="form-input" id="profileCity" placeholder="e.g. Camelot">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Logo URL (optional)</label>
          <input type="url" class="form-input" id="profileLogoUrl" placeholder="https://..." oninput="updateImagePreview('profileLogoUrl','profileLogoPreview')">
          <div id="profileLogoPreview" style="margin-top:6px;"></div>
        </div>
        <div class="form-group">
          <label class="form-label">QR Code URL (optional)</label>
          <input type="url" class="form-input" id="profileQrUrl" placeholder="https://..." oninput="updateImagePreview('profileQrUrl','profileQrPreview')">
          <div id="profileQrPreview" style="margin-top:6px;"></div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Social Links</label>
        <div class="social-inputs">
          <div class="social-input-group">
            <div class="social-icon social-fb"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></div>
            <input type="url" class="form-input" id="profileFB" placeholder="Facebook URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-ig"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg></div>
            <input type="url" class="form-input" id="profileIG" placeholder="Instagram URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-sc"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12.206.793c.99 0 4.347.276 5.93 3.821.529 1.193.403 3.219.299 4.847l-.003.06c-.012.18-.022.345-.03.51.075.045.203.09.401.09.3-.016.659-.12 1.033-.301a.602.602 0 01.257-.058c.21 0 .42.089.554.239.18.18.244.458.164.694-.135.449-.61.795-1.411 1.024a5.39 5.39 0 01-.534.12c-.164.03-.296.057-.404.09-.372.12-.433.36-.433.584 0 .135.03.27.09.42.57 1.199 1.425 2.175 2.46 2.805.36.21.72.36 1.08.449.18.045.33.12.42.24.12.135.165.33.12.51-.135.6-1.11.899-1.62 1.05-.12.03-.21.06-.27.084l-.015.03c-.12.255-.24.54-.615.66a1.126 1.126 0 01-.36.06c-.27 0-.6-.105-1.005-.225-.48-.135-.93-.254-1.32-.254-.18 0-.33.015-.45.06a6.502 6.502 0 01-2.58.51c-.06 0-.12 0-.195-.016h-.18a6.607 6.607 0 01-2.58-.51c-.12-.045-.27-.06-.45-.06-.39 0-.84.12-1.32.255-.405.12-.735.225-1.005.225a1.126 1.126 0 01-.36-.06c-.375-.12-.495-.405-.615-.66l-.015-.03a2.656 2.656 0 00-.27-.084c-.51-.15-1.485-.45-1.62-1.05-.045-.18 0-.375.12-.51.09-.12.24-.195.42-.24.36-.084.72-.24 1.08-.449 1.035-.63 1.89-1.606 2.46-2.805.06-.135.09-.27.09-.42 0-.224-.06-.464-.434-.584a4.79 4.79 0 01-.403-.09 5.39 5.39 0 01-.534-.12c-.801-.229-1.276-.575-1.411-1.024a.657.657 0 01.164-.694.564.564 0 01.554-.24c.105 0 .18.015.256.06.374.18.734.3 1.035.3.199 0 .324-.046.399-.09l-.03-.509-.003-.061c-.104-1.628-.23-3.654.3-4.846C7.648 1.07 11.015.793 12.006.793h.2z"/></svg></div>
            <input type="url" class="form-input" id="profileSC" placeholder="Snapchat URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-sg"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 3.6c2.34 0 4.242 1.902 4.242 4.242V9.6h.558a.6.6 0 01.6.6v7.2a.6.6 0 01-.6.6H7.2a.6.6 0 01-.6-.6v-7.2a.6.6 0 01.6-.6h.558V7.842C7.758 5.502 9.66 3.6 12 3.6zm0 1.8c-1.35 0-2.442 1.092-2.442 2.442V9.6h4.884V7.842C14.442 6.492 13.35 5.4 12 5.4z"/></svg></div>
            <input type="url" class="form-input" id="profileSG" placeholder="Signal group link">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-rd"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 01.042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 014.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 01.14-.197.35.35 0 01.238-.042l2.906.617a1.214 1.214 0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 00-.231.094.33.33 0 000 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 000-.462.342.342 0 00-.461 0c-.545.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 00-.206-.095z"/></svg></div>
            <input type="url" class="form-input" id="profileRD" placeholder="Reddit URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-x"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></div>
            <input type="url" class="form-input" id="profileX" placeholder="X / Twitter URL">
          </div>
        </div>
      </div>
      <div class="form-group" style="margin-bottom:0;">
        <label class="form-label">Organizers</label>
        <div id="profileOrgMembers" style="margin-bottom:8px;"></div>
        <div style="display:flex;gap:8px;align-items:center;">
          <input type="email" class="form-input" id="profileAddMemberEmail" placeholder="Add organizer by email..." style="flex:1;">
          <button class="btn btn-secondary btn-sm" onclick="addOrgMember()">Add</button>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('profileModal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
    </div>
  </div>
</div>

<!-- NEW MESSAGE MODAL -->
<div class="modal-overlay" id="newMessageModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2>New Message</h2>
      <button class="modal-close" onclick="closeModal('newMessageModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <div class="form-group" id="sendAsGroup" style="display:none;">
        <label class="form-label">Send As</label>
        <select class="form-input" id="msgSendAs"></select>
      </div>
      <div class="form-group">
        <label class="form-label">Topic *</label>
        <input type="text" class="form-input" id="newMsgTopic" placeholder="e.g. Question about event approval process">
      </div>
      <div class="form-group">
        <label class="form-label">Message *</label>
        <textarea class="form-textarea" id="newMsgText" rows="5" placeholder="Type your message here..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('newMessageModal')">Cancel</button>
      <button class="btn btn-primary" onclick="submitNewMessage()">Submit</button>
    </div>
  </div>
</div>

<!-- ADMIN NEW MESSAGE MODAL -->
<div class="modal-overlay" id="adminNewMessageModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2>New Admin Message</h2>
      <button class="modal-close" onclick="closeModal('adminNewMessageModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Send To</label>
        <div style="display:flex;gap:8px;margin-bottom:8px;">
          <button class="btn btn-sm" id="adminMsgToOrg" onclick="setAdminMsgRecipientType('org')">Organization</button>
          <button class="btn btn-sm" id="adminMsgToUser" onclick="setAdminMsgRecipientType('user')">User</button>
        </div>
        <select class="form-input" id="adminMsgOrgSelect" style="display:none;">
          <option value="">-- Select Organization --</option>
        </select>
        <div id="adminMsgUserSearchWrap" style="display:none;position:relative;">
          <input type="text" class="form-input" id="adminMsgUserSearch" placeholder="Search by name or email..." oninput="filterAdminMsgUsers()">
          <div class="autocomplete-dropdown" id="adminMsgUserDropdown"></div>
          <input type="hidden" id="adminMsgUserId">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Topic *</label>
        <input type="text" class="form-input" id="adminNewMsgTopic">
      </div>
      <div class="form-group">
        <label class="form-label">Message *</label>
        <textarea class="form-textarea" id="adminNewMsgText" rows="5"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('adminNewMessageModal')">Cancel</button>
      <button class="btn btn-primary" onclick="submitAdminNewMessage()">Send</button>
    </div>
  </div>
</div>

<!-- ORG EDIT MODAL (admin) -->
<div class="modal-overlay" id="orgEditModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2 id="orgEditModalTitle">Add Organization</h2>
      <button class="modal-close" onclick="closeModal('orgEditModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="orgEditId">
      <div class="form-group">
        <label class="form-label">Organization Name *</label>
        <input type="text" class="form-input" id="orgEditName" placeholder="e.g. Knights of the Round Table">
      </div>
      <div class="form-group">
        <label class="form-label">Abbreviation *</label>
        <input type="text" class="form-input" id="orgEditAbbr" placeholder="e.g. KRT" maxlength="10">
      </div>
      <div class="form-group">
        <label class="form-label">Mission Statement</label>
        <textarea class="form-input" id="orgEditMission" rows="2" maxlength="140"
          oninput="updateOrgEditMissionCounter()" placeholder="A short sentence describing your org..."></textarea>
        <div style="display:flex;justify-content:flex-end;margin-top:4px;">
          <span id="orgEditMissionCounter" style="font-size:11px;color:var(--text-dim);">0 / 140</span>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Website</label>
          <input type="url" class="form-input" id="orgEditWebsite" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">City</label>
          <input type="text" class="form-input" id="orgEditCity" placeholder="e.g. Camelot">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Logo URL (optional)</label>
          <input type="url" class="form-input" id="orgEditLogoUrl" placeholder="https://..." oninput="updateImagePreview('orgEditLogoUrl','orgEditLogoPreview')">
          <div id="orgEditLogoPreview" style="margin-top:6px;"></div>
        </div>
        <div class="form-group">
          <label class="form-label">QR Code URL (optional)</label>
          <input type="url" class="form-input" id="orgEditQrUrl" placeholder="https://..." oninput="updateImagePreview('orgEditQrUrl','orgEditQrPreview')">
          <div id="orgEditQrPreview" style="margin-top:6px;"></div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Social Links</label>
        <div class="social-inputs">
          <div class="social-input-group">
            <div class="social-icon social-fb"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></div>
            <input type="url" class="form-input" id="orgEditFB" placeholder="Facebook URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-ig"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg></div>
            <input type="url" class="form-input" id="orgEditIG" placeholder="Instagram URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-sc"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12.206.793c.99 0 4.347.276 5.93 3.821.529 1.193.403 3.219.299 4.847l-.003.06c-.012.18-.022.345-.03.51.075.045.203.09.401.09.3-.016.659-.12 1.033-.301a.602.602 0 01.257-.058c.21 0 .42.089.554.239.18.18.244.458.164.694-.135.449-.61.795-1.411 1.024a5.39 5.39 0 01-.534.12c-.164.03-.296.057-.404.09-.372.12-.433.36-.433.584 0 .135.03.27.09.42.57 1.199 1.425 2.175 2.46 2.805.36.21.72.36 1.08.449.18.045.33.12.42.24.12.135.165.33.12.51-.135.6-1.11.899-1.62 1.05-.12.03-.21.06-.27.084l-.015.03c-.12.255-.24.54-.615.66a1.126 1.126 0 01-.36.06c-.27 0-.6-.105-1.005-.225-.48-.135-.93-.254-1.32-.254-.18 0-.33.015-.45.06a6.502 6.502 0 01-2.58.51c-.06 0-.12 0-.195-.016h-.18a6.607 6.607 0 01-2.58-.51c-.12-.045-.27-.06-.45-.06-.39 0-.84.12-1.32.255-.405.12-.735.225-1.005.225a1.126 1.126 0 01-.36-.06c-.375-.12-.495-.405-.615-.66l-.015-.03a2.656 2.656 0 00-.27-.084c-.51-.15-1.485-.45-1.62-1.05-.045-.18 0-.375.12-.51.09-.12.24-.195.42-.24.36-.084.72-.24 1.08-.449 1.035-.63 1.89-1.606 2.46-2.805.06-.135.09-.27.09-.42 0-.224-.06-.464-.434-.584a4.79 4.79 0 01-.403-.09 5.39 5.39 0 01-.534-.12c-.801-.229-1.276-.575-1.411-1.024a.657.657 0 01.164-.694.564.564 0 01.554-.24c.105 0 .18.015.256.06.374.18.734.3 1.035.3.199 0 .324-.046.399-.09l-.03-.509-.003-.061c-.104-1.628-.23-3.654.3-4.846C7.648 1.07 11.015.793 12.006.793h.2z"/></svg></div>
            <input type="url" class="form-input" id="orgEditSC" placeholder="Snapchat URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-sg"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 3.6c2.34 0 4.242 1.902 4.242 4.242V9.6h.558a.6.6 0 01.6.6v7.2a.6.6 0 01-.6.6H7.2a.6.6 0 01-.6-.6v-7.2a.6.6 0 01.6-.6h.558V7.842C7.758 5.502 9.66 3.6 12 3.6zm0 1.8c-1.35 0-2.442 1.092-2.442 2.442V9.6h4.884V7.842C14.442 6.492 13.35 5.4 12 5.4z"/></svg></div>
            <input type="url" class="form-input" id="orgEditSG" placeholder="Signal group link">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-rd"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 01.042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 014.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 01.14-.197.35.35 0 01.238-.042l2.906.617a1.214 1.214 0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 00-.231.094.33.33 0 000 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 000-.462.342.342 0 00-.461 0c-.545.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 00-.206-.095z"/></svg></div>
            <input type="url" class="form-input" id="orgEditRD" placeholder="Reddit URL">
          </div>
          <div class="social-input-group">
            <div class="social-icon social-x"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></div>
            <input type="url" class="form-input" id="orgEditX" placeholder="X / Twitter URL">
          </div>
        </div>
      </div>
      <div class="form-group" id="orgEditPublishPerms" style="display:none;">
        <label class="form-label">Publishing Permissions</label>
        <label class="form-check">
          <input type="checkbox" id="orgEditSelfPublish">
          Allow this org to publish their own events without admin approval
        </label>
        <label class="form-check" style="margin-top:6px;">
          <input type="checkbox" id="orgEditCrossPublish">
          Allow this org to publish events for other organizations without admin approval
        </label>
      </div>
      <div id="orgEditOrganizers" style="display:none;">
        <div class="form-group" style="margin-bottom:0;">
          <label class="form-label">Approved Organizers</label>
          <div id="orgEditOrganizersList" style="font-size:13px;color:var(--text-muted);"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('orgEditModal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveOrgEdit()">Save</button>
    </div>
  </div>
</div>

<!-- USER EDIT MODAL (admin) -->
<div class="modal-overlay" id="userEditModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2 id="userEditModalTitle">Add User</h2>
      <button class="modal-close" onclick="closeModal('userEditModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="userEditId">
      <div class="form-group">
        <label class="form-label">Display Name *</label>
        <input type="text" class="form-input" id="userEditName" placeholder="e.g. Sir Lancelot">
      </div>
      <div class="form-group">
        <label class="form-label">Email *</label>
        <input type="email" class="form-input" id="userEditEmail" placeholder="user@example.com">
      </div>
      <div class="form-group">
        <label class="form-label">Role</label>
        <select class="form-input" id="userEditRole" onchange="onUserRoleChange()">
          <option value="guest">Guest</option>
          <option value="organizer">Organizer</option>
          <option value="admin">Admin</option>
        </select>
      </div>
      <div class="form-group" id="userEditOrgGroup">
        <label class="form-label">Organization</label>
        <select class="form-input" id="userEditOrg">
          <option value="">None</option>
        </select>
        <p class="form-hint" id="userEditOrgHint" style="display:none;">Organizer role requires an organization.</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('userEditModal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveUserEdit()">Save</button>
    </div>
  </div>
</div>

<!-- PRIVACY POLICY MODAL -->
<div class="modal-overlay" id="privacyModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2>Privacy Policy</h2>
      <button class="modal-close" onclick="closeModal('privacyModal')">&#x2715;</button>
    </div>
    <div class="modal-body" id="privacyContent" style="font-size:14px;line-height:1.7;color:var(--text-muted);">
      <p style="color:var(--text-muted);">Loading...</p>
    </div>
  </div>
</div>

<!-- TERMS OF SERVICE MODAL -->
<div class="modal-overlay" id="termsModal">
  <div class="modal-box">
    <div class="modal-header">
      <h2>Terms of Service</h2>
      <button class="modal-close" onclick="closeModal('termsModal')">&#x2715;</button>
    </div>
    <div class="modal-body" id="termsContent" style="font-size:14px;line-height:1.7;color:var(--text-muted);">
      <p style="color:var(--text-muted);">Loading...</p>
    </div>
  </div>
</div>

<!-- BACKUP KEY MODAL -->
<div class="modal-overlay" id="backupKeyModal">
  <div class="modal-box" style="max-width:560px;">
    <div class="modal-header">
      <h2>Backup Created</h2>
      <button class="modal-close" onclick="closeModal('backupKeyModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <div style="padding:12px;background:rgba(255,180,50,0.1);border:1px solid rgba(255,180,50,0.3);border-radius:var(--radius-sm);margin-bottom:16px;font-size:13px;">
        <strong>Save this key!</strong> It is shown only once and never stored. You will need it to restore this backup. The IV is embedded in the backup file — you do not need to save it separately.
      </div>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div>
          <label class="form-label">File</label>
          <code id="backupKeyFilename" style="display:block;padding:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);font-size:12px;word-break:break-all;"></code>
        </div>
        <div style="display:flex;gap:16px;">
          <div><label class="form-label">Backup ID</label><span id="backupKeyId" style="font-size:13px;"></span></div>
          <div><label class="form-label">Size</label><span id="backupKeySize" style="font-size:13px;"></span></div>
        </div>
        <div>
          <label class="form-label">Encryption Key</label>
          <div style="display:flex;gap:8px;align-items:flex-start;">
            <code id="backupKeyValue" style="flex:1;display:block;padding:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);font-size:11px;word-break:break-all;color:var(--sage);"></code>
            <button class="btn btn-ghost btn-xs" onclick="navigator.clipboard.writeText(document.getElementById('backupKeyValue').textContent);showToast('Key copied!')">Copy</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display:flex;justify-content:flex-end;">
      <button class="btn btn-primary btn-sm" onclick="closeModal('backupKeyModal')">I've saved the key</button>
    </div>
  </div>
</div>

<!-- SCHEDULE SCRIPT MODAL -->
<div class="modal-overlay" id="scheduleScriptModal">
  <div class="modal-box" style="max-width:700px;">
    <div class="modal-header">
      <h2>Auto Backup Worker Script</h2>
      <button class="modal-close" onclick="closeModal('scheduleScriptModal')">&#x2715;</button>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px;">Deploy this Worker to Cloudflare to run automated backups. Set your domain and secrets as described in the wrangler.toml.</p>
      <div style="display:flex;gap:6px;margin-bottom:12px;border-bottom:1px solid var(--border);padding-bottom:0;">
        <button class="db-tab-btn active" id="scriptTabWorkerBtn" onclick="switchScriptTab('worker')">worker.js</button>
        <button class="db-tab-btn" id="scriptTabTomlBtn" onclick="switchScriptTab('toml')">wrangler.toml</button>
      </div>
      <div id="scriptTabWorker">
        <div style="display:flex;justify-content:flex-end;gap:6px;margin-bottom:6px;">
          <button class="btn btn-ghost btn-xs" onclick="navigator.clipboard.writeText(document.getElementById('scheduleScriptWorker').textContent);showToast('Copied!')">Copy</button>
          <button class="btn btn-ghost btn-xs" onclick="downloadText(document.getElementById('scheduleScriptWorker').textContent,'worker.js')">Download</button>
        </div>
        <pre id="scheduleScriptWorker" style="background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px;font-size:11px;overflow:auto;max-height:400px;white-space:pre-wrap;word-break:break-all;margin:0;"></pre>
      </div>
      <div id="scriptTabToml" style="display:none;">
        <div style="display:flex;justify-content:flex-end;gap:6px;margin-bottom:6px;">
          <button class="btn btn-ghost btn-xs" onclick="navigator.clipboard.writeText(document.getElementById('scheduleScriptToml').textContent);showToast('Copied!')">Copy</button>
          <button class="btn btn-ghost btn-xs" onclick="downloadText(document.getElementById('scheduleScriptToml').textContent,'wrangler.toml')">Download</button>
        </div>
        <pre id="scheduleScriptToml" style="background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px;font-size:11px;overflow:auto;max-height:400px;white-space:pre-wrap;word-break:break-all;margin:0;"></pre>
      </div>
    </div>
  </div>
</div>

<!-- CONFIRMATION DIALOG -->
<div class="confirm-overlay" id="confirmDialog">
  <div class="confirm-box">
    <h3 id="confirmTitle">Archive Event?</h3>
    <p id="confirmMessage">This action is permanent.</p>
    <div class="confirm-actions">
      <button class="btn btn-ghost btn-sm" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-danger btn-sm" id="confirmBtn">Confirm</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ======= ADMIN DRAWER ======= -->
<div class="drawer-overlay" id="adminDrawerOverlay" onclick="closeAdminDrawer()"></div>
<div class="admin-drawer" id="adminDrawer">
  <div class="drawer-header">
    <h3>Admin</h3>
    <button class="btn btn-ghost btn-sm" onclick="closeAdminDrawer()">&#x2715;</button>
  </div>
  <div class="drawer-body">
    <button class="drawer-item" onclick="navigateFromDrawer('reviewQueue')">
      Admin Queue <span class="nav-badge" id="reviewBadge" style="display:none;">0</span>
    </button>
    <button class="drawer-item" onclick="navigateFromDrawer('adminMessages')">
      Messages <span class="nav-badge" id="adminMsgBadge" style="display:none;">0</span>
    </button>
    <hr style="border:none;border-top:1px solid var(--border);margin:4px 0;">
    <button class="drawer-item" onclick="navigateFromDrawer('manageOrgs')">Manage Orgs</button>
    <button class="drawer-item" onclick="navigateFromDrawer('manageUsers')">Manage Users</button>
    <hr style="border:none;border-top:1px solid var(--border);margin:4px 0;">
    <button class="drawer-item" onclick="navigateFromDrawer('eventSettings')">Event Settings</button>
    <button class="drawer-item" onclick="navigateFromDrawer('siteSettings')">Site Settings</button>
    <button class="drawer-item" onclick="navigateFromDrawer('dbSettings')">Database Settings</button>
  </div>
</div>

<script src="/js/setup-wizard.js?v=5"></script>
<script src="/js/config.js?v=5"></script>
<script src="/js/app.js?v=5"></script>
</body>
</html>
